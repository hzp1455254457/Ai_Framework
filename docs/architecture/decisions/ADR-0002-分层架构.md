# ADR-0002: 采用分层架构设计

## 状态
已接受

## 背景

AI框架需要清晰的代码组织，支持多个应用接口（API、CLI、Web UI），同时保持核心业务逻辑的可复用性和可测试性。需要一个清晰的架构模式组织代码。

## 考虑的方案

### 方案1：四层分层架构
**描述**：应用层 → 核心服务层 → 适配器层 → 基础设施层

**优点**：
- 层次清晰，职责明确
- 便于理解和维护
- 支持多种应用接口
- 核心逻辑可复用

**缺点**：
- 层级较多，可能增加调用深度
- 需要明确各层职责边界

### 方案2：三层架构（应用层、业务层、数据层）
**描述**：传统的三层架构

**优点**：
- 层级少，调用简单
- 经典架构模式

**缺点**：
- 不够细致，业务层包含太多职责
- 不适合多提供商适配的场景

### 方案3：微服务架构
**描述**：每个服务独立部署

**优点**：
- 高度解耦
- 可独立扩展

**缺点**：
- 对于个人框架过度设计
- 增加运维复杂度
- 不适合轻量级定位

## 决策

选择**方案1：四层分层架构**

**理由**：
1. 符合框架的轻量级定位，不需要分布式架构
2. 层次清晰，每层职责明确，便于理解和维护
3. 支持多种应用接口（API、CLI、Web），核心逻辑可复用
4. 适配器层独立，便于管理多提供商支持
5. 基础设施层独立，便于替换实现（如缓存后端）

## 架构层次

1. **应用层**：用户接口（API、CLI、Web UI）
2. **核心服务层**：业务逻辑（LLM、Vision、Audio、Agent）
3. **适配器层**：第三方服务适配（OpenAI、Claude等）
4. **基础设施层**：基础能力（配置、缓存、日志、存储）

## 后果

### 正面影响
- ✅ 代码组织清晰，易于理解
- ✅ 职责分离，便于维护和测试
- ✅ 核心逻辑可复用，支持多种应用接口
- ✅ 易于扩展新功能

### 负面影响
- ⚠️ 调用链可能较深（但这是合理的设计权衡）
- ⚠️ 需要明确各层职责，避免越层调用

### 风险缓解
- 通过明确的依赖关系规则避免越层调用
- 通过清晰的文档说明各层职责

## 日期
2026-01-21

## 相关ADR
- ADR-0001（适配器模式）- 适配器层是分层架构的一部分

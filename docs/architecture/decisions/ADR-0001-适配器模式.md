# ADR-0001: 使用适配器模式实现多LLM提供商支持

## 状态
已接受

## 背景

AI框架需要支持多个LLM提供商（OpenAI、Claude、Ollama等），每个提供商的API接口、请求格式、响应格式都不相同。需要一个统一的方式管理这些不同的提供商。

## 考虑的方案

### 方案1：适配器模式
**描述**：定义统一的LLM接口，为每个提供商实现独立的适配器。

**优点**：
- 统一接口，调用方无需关心具体提供商
- 易于扩展，新增提供商只需添加新适配器
- 低耦合，各适配器独立实现和维护
- 符合开闭原则

**缺点**：
- 需要抽象设计，初期工作量大
- 可能存在功能差异需要统一处理

### 方案2：直接在Service中实现
**描述**：在LLMService中直接根据提供商类型调用不同的API。

**优点**：
- 实现简单，无需额外抽象层
- 可以直接使用各提供商的特有功能

**缺点**：
- 代码耦合度高，难以维护
- 新增提供商需要修改Service代码
- 违反开闭原则
- 难以测试

### 方案3：使用策略模式
**描述**：使用策略模式切换不同的LLM提供商实现。

**优点**：
- 运行时可以动态切换策略
- 每个策略独立封装

**缺点**：
- 与适配器模式类似，但语义上适配器模式更适合接口转换场景

## 决策

选择**方案1：适配器模式**

**理由**：
1. 适配器模式最适合"将不同接口统一化"的场景
2. 符合框架的扩展性要求，便于后续添加新的提供商
3. 代码结构清晰，易于理解和维护
4. 便于单元测试，每个适配器可以独立测试

## 实现要点

1. 定义 `BaseAdapter` 抽象基类，定义统一的接口
2. 每个提供商实现独立的适配器类（如 `OpenAIAdapter`）
3. LLMService通过适配器接口调用，不直接依赖具体实现
4. 适配器负责将统一接口转换为提供商特定的API调用

## 后果

### 正面影响
- ✅ 代码结构清晰，易于理解和维护
- ✅ 易于扩展，新增提供商只需添加新适配器
- ✅ 便于测试，可以轻松Mock适配器
- ✅ 降低耦合度，提高代码质量

### 负面影响
- ⚠️ 增加了一层抽象，可能有微小的性能开销（可忽略）
- ⚠️ 需要维护适配器抽象接口的稳定性

### 风险缓解
- 性能开销很小，主要是方法调用开销，可忽略不计
- 通过明确的接口规范保证适配器接口的稳定性

## 日期
2026-01-21

## 相关ADR
- ADR-0002（分层架构设计）- 适配器层是分层架构的一部分

# AI框架默认配置文件
# 配置版本: 2.0
config_version: "2.0"

# LLM服务配置
llm:
  implementation: "langchain"  # 实现类型：native/litellm/langchain（使用LangChain实现）
  api_key: ""  # API密钥，通过环境变量或环境配置文件设置（支持加密存储，使用 encrypted: 前缀）
  timeout: 30  # 请求超时时间（秒）
  max_retries: 3  # 最大重试次数
  default_model: "qwen-turbo-2024-11-01"  # 默认模型（新版API格式）
  default_adapter: ""  # 默认适配器名称（可选，不设置则自动选择）
  auto_discover_adapters: true  # 是否自动发现和注册适配器
  
  # 健康检查配置
  health_check:
    enabled: true  # 是否启用健康检查
    timeout: 5.0  # 健康检查超时时间（秒）
    interval: 60  # 健康检查间隔（秒，0表示不自动检查）
    failover_enabled: true  # 是否启用故障转移（自动选择健康适配器）
  
  # 路由配置（可选，启用智能路由）
  enable_routing: false  # 是否启用适配器路由层
  default_routing_strategy: "balanced"  # 默认路由策略：cost_first/performance_first/availability_first/balanced
  
  # 性能优化配置
  performance:
    enable_connection_pool: true  # 是否启用HTTP连接池
    max_connections: 100  # 最大连接数
    max_keepalive_connections: 20  # 最大保持活跃连接数
    connection_timeout: 30.0  # 连接超时时间（秒）
    enable_cache: true  # 是否启用请求缓存
    cache_ttl: 3600.0  # 缓存生存时间（秒）
    cache_max_size: 1000  # 最大缓存条目数
    enable_deduplication: true  # 是否启用请求去重
    batch_size: 10  # 批量处理大小
    max_concurrent: 5  # 最大并发数
  
  # 成本管理配置
  cost:
    enabled: true  # 是否启用成本管理
    daily_budget: 0.0  # 每日预算（美元，0表示无限制）
    monthly_budget: 0.0  # 每月预算（美元，0表示无限制）
    alert_threshold: 0.8  # 告警阈值（0-1，0.8表示80%）
    budget_enabled: false  # 是否启用预算管理
  
  # 监控和可观测性配置
  monitoring:
    enabled: true  # 是否启用监控
    tracing_enabled: true  # 是否启用请求追踪
    tracing:
      max_traces: 1000  # 最大追踪数
      trace_ttl: 3600  # 追踪TTL（秒）
  
  # 适配器配置（每个适配器的独立配置）
  adapters:
    openai-adapter:
      api_key: ""  # OpenAI API密钥
      base_url: "https://api.openai.com/v1"  # 可选，支持自定义端点
    doubao-adapter:
      api_key: ""  # 豆包API密钥
      base_url: "https://ark.cn-beijing.volces.com/api/v3"  # 可选
    qwen-adapter:
      api_key: "sk-26d4187aac964ec3b72c1cbd52f1a841"  # 通义千问API密钥
      base_url: "https://dashscope.aliyuncs.com/api/v1"  # 可选
    deepseek-adapter:
      api_key: ""  # DeepSeek API密钥
      base_url: "https://api.deepseek.com/v1"  # 可选
    litellm-adapter:
      api_key: ""  # LiteLLM API密钥（可选，LiteLLM可以从环境变量读取）
      model: ""  # 默认模型（可选）
      litellm_config:  # LiteLLM特定配置
        api_base: ""  # 可选，自定义API端点
        api_version: ""  # 可选，API版本
  
  # 模型到适配器的映射（可选，会自动推断）
  model_adapter_mapping:
    # 通义千问模型（新格式）
    "qwen-turbo": "qwen-adapter"
    "qwen-turbo-2024-11-01": "qwen-adapter"
    "qwen-plus": "qwen-adapter"
    "qwen-plus-2024-11-01": "qwen-adapter"
    "qwen-max": "qwen-adapter"
    "qwen-max-2024-11-01": "qwen-adapter"
    "qwen-long": "qwen-adapter"

# 缓存配置
cache:
  backend: "memory"  # 缓存后端：memory/redis/file
  ttl: 3600  # 缓存过期时间（秒）
  max_size: 1000  # 最大缓存条目数

# 日志配置
log:
  level: "INFO"  # 日志级别：DEBUG/INFO/WARNING/ERROR/CRITICAL
  file: "logs/app.log"  # 日志文件路径（可选）
  max_bytes: 10485760  # 日志文件最大大小（10MB）
  backup_count: 5  # 备份文件数量
  
  # 数据脱敏配置
  masking:
    enabled: true  # 是否启用数据脱敏（生产环境建议启用）
    mode: "partial"  # 脱敏模式：partial（部分隐藏）/full（完全隐藏）/hash（哈希）
    keep_prefix: 3  # 部分隐藏时保留的前缀长度
    keep_suffix: 2  # 部分隐藏时保留的后缀长度
    custom_rules: []  # 自定义脱敏规则（可选）
      # 示例：
      # - name: "custom_id"
      #   pattern: "ID:\\d+"

# 存储配置
storage:
  backend: "sqlite"  # 存储后端：sqlite/postgresql
  database: "data/app.db"  # 数据库文件路径

# Agent配置
agent:
  implementation: "native"  # 实现类型：native/langchain/langgraph（临时使用原生实现，LangChain回调参数问题待修复）
  max_iterations: 10  # 最大迭代次数
  timeout: 300  # Agent任务超时时间（秒）
  enable_long_term_memory: false  # 是否启用长期记忆
  enable_planner: false  # 是否启用任务规划器
  enable_langchain: false  # 是否启用LangChain集成（可选，已废弃，使用implementation替代）
  enable_langgraph: false  # 是否启用LangGraph集成（可选，已废弃，使用implementation替代）
  max_messages: null  # 最大消息数（null表示无限制）
  
  # LangChain配置（当implementation为langchain时生效）
  agent_type: "openai-functions"  # Agent类型：openai-functions/openai-multi-functions/react/self-ask-with-search
  verbose: false  # 是否输出详细日志
  return_intermediate_steps: true  # 是否返回中间步骤（工具调用信息）
  
  # LangChain配置（可选，兼容旧配置）
  langchain:
    enabled: false  # 是否启用LangChain
    memory_type: "buffer"  # 记忆类型：buffer/summary
    default_chain_type: "llm_chain"  # 默认链类型
  
  # LangGraph配置（可选）
  langgraph:
    enabled: false  # 是否启用LangGraph
    persist_state: false  # 是否持久化工作流状态
  
  # 互联网访问工具配置
  web_tools:
    enabled: true  # 是否启用互联网工具（默认true）
    web_search:
      enabled: true  # 是否启用web_search工具
      search_engine: "duckduckgo"  # 搜索引擎类型：duckduckgo/google/bing
      api_key: ""  # API密钥（Google/Bing需要，DuckDuckGo不需要）
      timeout: 10.0  # 请求超时时间（秒）
      max_retries: 2  # 最大重试次数
    fetch_webpage:
      enabled: true  # 是否启用fetch_webpage工具
      timeout: 10.0  # 请求超时时间（秒）
      max_retries: 2  # 最大重试次数
      max_length: 10000  # 最大返回文本长度（字符数）

# 工具配置
tools:
  implementation: "langchain"  # 实现类型：native/langchain（使用LangChain实现）
  auto_register_langchain_tools: true  # 自动注册LangChain原生工具（如DuckDuckGo搜索）
  allow_native_tools: false  # 是否允许注册自研工具（false表示只使用LangChain原生工具）

# 记忆配置
memory:
  implementation: "langchain"  # 实现类型：native/langchain（使用LangChain实现）

# 规划器配置
planner:
  enable_cache: true  # 是否启用规划结果缓存
  model: null  # 规划器使用的模型（null表示使用默认模型）

# 向量数据库配置
vector_db:
  backend: "chroma"  # 向量后端：chroma 或 sqlite-vss
  persist_directory: "./chroma_db"  # Chroma持久化目录
  host: "localhost"  # Chroma服务器地址（如果使用服务器模式）
  port: 8000  # Chroma服务器端口

# 多Agent协作配置
collaboration:
  strategy: "round_robin"  # 任务分配策略：round_robin/load_balancing/specialization

# Vision服务配置
vision:
  default_adapter: ""  # 默认适配器名称（可选，不设置则使用第一个注册的适配器）
  auto_discover_adapters: false  # 是否自动发现和注册适配器（当前未实现）
  
  # 健康检查配置
  health_check:
    enabled: true  # 是否启用健康检查
    timeout: 5.0  # 健康检查超时时间（秒）
    interval: 60  # 健康检查间隔（秒，0表示不自动检查）
    failover_enabled: true  # 是否启用故障转移（自动选择健康适配器）
  
  # 适配器配置（每个适配器的独立配置）
  adapters:
    dalle-adapter:
      api_key: ""  # DALL-E API密钥（OpenAI API密钥）
      base_url: "https://api.openai.com/v1"  # 可选，默认OpenAI API端点
      default_model: "dall-e-3"  # 默认模型（dall-e-2 或 dall-e-3）
    stable-diffusion-adapter:
      api_key: ""  # Stable Diffusion API密钥（支持加密存储）
      base_url: ""  # API端点URL

# 运行时配置（抽象接口架构）
runtime:
  allow_switching: true  # 是否允许运行时切换实现（默认true）
  hot_reload: false  # 是否支持热重载（默认false，暂未实现）

# 加密配置（可选）
# encryption_key: ""  # 加密主密钥（建议通过环境变量 ENCRYPTION_KEY 设置）
# 注意：生产环境必须设置加密主密钥，用于加密存储API密钥等敏感信息
# 加密格式：在配置值前添加 "encrypted:" 前缀，例如：
#   api_key: "encrypted:salt:iv:ciphertext:tag"
# 使用 ConfigManager.encrypt_value() 方法生成加密值
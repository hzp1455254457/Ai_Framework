# 性能基准测试

本目录包含性能基准测试，用于确保新架构的性能不下降。

## 测试内容

- **聊天延迟测试**：测试启用/未启用优化时的请求延迟
- **缓存性能测试**：测试缓存对性能的提升
- **并发请求测试**：测试并发处理能力
- **流式响应延迟测试**：测试流式响应的首块延迟
- **内存使用测试**：测试内存使用情况
- **资源清理测试**：测试资源清理功能

## 运行测试

```bash
# 运行所有性能测试
pytest tests/performance/ -v -m performance

# 运行特定测试
pytest tests/performance/test_benchmark.py::TestPerformanceBenchmark::test_chat_latency_with_optimization -v
```

## 性能指标

### 延迟指标
- 平均延迟：< 50ms（启用优化）
- 最大延迟：< 100ms（启用优化）
- 首块延迟：< 50ms（流式响应）

### 并发性能
- 20个并发请求总时间：< 150ms

### 内存使用
- 100次请求后内存增长：< 50MB

## 注意事项

- 性能测试可能需要较长时间，标记为 `@pytest.mark.slow`
- 某些测试需要 `psutil` 库（内存测试）
- 测试结果可能因环境而异，重点关注相对性能
